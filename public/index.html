<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
  <title>AVN Player</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Container for HTML overlays (iframes) -->
  <div id="iframe-container"></div>
  <!-- NEW: Container for Markdown overlays -->
  <div id="markdown-container"></div>

  <canvas id="graphCanvas" title="Graph"></canvas>

  <!-- UNIFIED TOP TOOLBAR -->
  <div id="topToolbar">
    <!-- Mode Switcher (Always Visible) -->
    <button id="toggleEditorModeBtn" title="Toggle Player/Editor Mode">ğŸ› ï¸ğŸ–¥ï¸ğŸ–±ï¸</button>
    <div class="divider"></div>

    <!-- Always Visible Buttons -->
    <button id="toggleAllNodesBtn" title="Collapse All Nodes">â–</button>
    <button id="followModeBtn" title="Lock current view and follow playback">ğŸ¯</button> 
    <button id="selectGraphBtn" title="Select Story" disabled>ğŸ“‚</button>
    <div class="divider"></div>

    <!-- Player Mode Controls (now empty) -->
    <div id="playerModeControls">
    </div>

    <!-- Editor Mode Controls (hidden by default) -->
    <div id="editorModeControls">
      <button id="addNodeBtn" title="Add New Node">ğŸ«</button>
      <button id="addRectBtn" title="Add Rectangle Shape">ğŸ”³</button>
      <button id="addTextBtn" title="Add Markdown Block">ğŸ“‹</button>
      <div class="divider"></div>
      <button id="lockDecorationsBtn" title="Lock/Unlock Decorations">ğŸ”“</button>
      <div class="divider"></div>
      <button id="groupSelectionBtn" title="Group Selected Decorations" disabled>Group</button>
      <button id="attachToNodeBtn" title="Attach Group to Node" disabled>Attach</button>
      <div class="divider"></div>
      <button id="exportBtn" title="Export">ğŸ’¾</button>
      <button id="resetBtn">Reset</button>
      <div class="divider"></div>
      <button id="deleteSelectionBtn" title="Delete Selected">ğŸ—‘ï¸</button>
    </div>
  </div>

  <!-- Properties Inspector Panel (hidden) -->
  <div id="inspectorPanel" class="hidden">
      <h4>Properties</h4>
      <div id="inspectorContent"></div>
      <button id="saveNodeBtn">Save Changes</button>
      <button id="closeInspectorBtn">Close</button>
  </div>

  <!-- Player and other UI -->
  <div id="player">
    <div id="playerContent">
      <div id="songTitle">Select a node to begin...</div>
      <div id="playerControls">
        <button id="backBtn" title="Go Back">â®</button>
        <button id="playBtn" title="Play/Pause">â–¶</button>
        <button id="nextBtn" title="Next">â­</button>
      </div>
      <!-- NEW: Progress container on its own line -->
      <div id="progressContainer">
        <input type="range" id="progress" value="0">
        <span id="currentTime">0:00</span>
      </div>
    </div>
  </div>
  <div id="lyricsContainer" class="hidden">
    <pre id="lyricsText">Loading lyrics...</pre>
    <button id="closeLyricsBtn" title="Close">Ã—</button>
  </div>
  <div id="choiceModal" class="hidden">
    <div class="modal-content">
      <h3>Choose the next step:</h3>
      <div id="choiceOptions"></div>
      <div id="choiceTimer" class="hidden">(Autoselecting in <span id="countdown">5</span>s)</div>
      <button id="closeModalBtn">Cancel</button>
    </div>
  </div>
  
  <!-- External Libraries for Markdown -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>

  <script src="js/app.js" type="module"></script>

  <!-- Graph Selection Modal -->
  <div id="graphSelectionModal" class="hidden">
    <div class="modal-content">
      <h3>Select a Story</h3>
      <div id="graphSelectionOptions"></div>
      <button id="closeGraphModalBtn">Cancel</button>
    </div>
  </div>

  <footer id="copyright">
    AVN Player Â© 2025 Nftxv â€” <a href="https://AbyssVoid.com/" target="_blank" rel="noopener nofollow">AbyssVoid.com</a>
  </footer>
</body>
</html>